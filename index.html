<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>üåæ DNX FARM ULTRA++ ‚Äî Gold Spark FX</title>

<!-- ===================== STYLE ===================== -->
<style>
:root{
  --gold:#ffd700; --neon:#00ffd5;
  --success:#00ff99; --error:#ff4d4d; --info:#00ccff;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow-x:hidden;}
body{
  background: radial-gradient(circle at center,#000 40%,#0b0b0b 100%);
  color:#fff;font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans",sans-serif;
  display:flex;flex-direction:column;align-items:center;justify-content:flex-start;min-height:100vh;overflow:hidden;
}

/* Header */
header{
  position:fixed;top:0;left:0;z-index:30;width:100%;
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 16px;border-bottom:2px solid var(--gold);
  background:linear-gradient(90deg,#111,#222,#111);
  box-shadow:0 0 20px rgba(255,215,0,.35);
}
.leftBox{display:flex;align-items:center;gap:10px}
.rightBox{display:flex;flex-direction:column;align-items:flex-end;gap:6px}

/* Buttons */
button{border:none;border-radius:12px;padding:10px 14px;margin:0;font-weight:700;cursor:pointer;transition:transform .12s ease,opacity .12s ease}
button:hover{transform:translateY(-1px)}
#langToggle{
  background:rgba(0,0,0,.6);border:1px solid var(--gold);color:var(--gold);padding:8px 12px;
}
#connectBtn{
  background:linear-gradient(90deg,#ffd700,#ff9d00);color:#000;border:none;border-radius:18px;padding:10px 18px;
  animation:glow 2s infinite alternate;
}
#refreshSmall{
  background:rgba(0,0,0,.65);border:1px solid #555;color:#bbb;font-weight:600;padding:6px 10px;border-radius:10px;font-size:12px;
}
.action{background:linear-gradient(90deg,#00ffd5,#00c8a7);color:#000}
.action.gold{background:linear-gradient(90deg,#ffd700,#ff9d00);color:#000}
.small{
  padding:8px 10px;border-radius:10px;font-size:13px;font-weight:700
}
#buyBtn{background:linear-gradient(90deg,#ff9d00,#ff5900);color:#000}
#sellBtn{background:linear-gradient(90deg,#ff7a7a,#ff2e2e);color:#000}

/* Logo */
#logo{
  position:fixed;top:70px;left:18px;width:84px;height:84px;border-radius:50%;
  background:url('dnx_logo.png') center/cover no-repeat;
  box-shadow:0 0 20px rgba(255,215,0,.55), inset 0 0 25px rgba(255,215,0,.45);
  animation:spin 12s linear infinite;z-index:10;
}

/* Title/Card */
h1{margin-top:150px;color:var(--gold);font-size:2rem;text-shadow:0 0 30px rgba(255,215,0,.6);text-align:center}
p.sub{opacity:.9;margin:6px 0 18px;text-align:center}
.card{
  position:relative;background:rgba(0,0,0,.68);border:2px solid var(--gold);border-radius:16px;
  box-shadow:0 0 30px rgba(255,215,0,.25);padding:22px;width:min(95%,620px);z-index:2;
}
.stats{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:10px}
.stat{background:rgba(255,255,255,.05);border:1px solid var(--neon);border-radius:10px;padding:10px}
.stat .label{font-size:13px;opacity:.8}
.stat .value{font-weight:800;color:var(--gold);word-break:break-all}
#pendingUSD{font-size:12px;color:#aaa;margin-top:2px}

input{
  width:80%;padding:10px;margin:10px 0;border-radius:10px;
  border:1px solid var(--neon);background:#000;color:#00ffd5;text-align:center
}

/* Section layout for buttons */
.btns{display:flex;flex-wrap:wrap;gap:8px;justify-content:center}
.stackedCol{display:flex;flex-direction:column;gap:8px;align-items:center;margin-top:8px}

/* Faucet info */
#faucetInfo{font-size:13px;color:#ccc;margin-top:6px}

/* Background gold particles (slow, luxury) */
#goldField{
  position:fixed;inset:0;z-index:0;pointer-events:none;opacity:.35;
}
.particle{
  position:absolute;width:6px;height:6px;border-radius:50%;
  background:radial-gradient(circle,#ffe47a 0%,#ffcd1f 40%,rgba(255,215,0,0) 70%);
  filter:blur(.2px);animation:float 22s linear infinite;
}
@keyframes float{
  from{transform:translateY(100vh) translateX(0) scale(.6);opacity:.0}
  10%{opacity:.7}
  90%{opacity:.7}
  to{transform:translateY(-10vh) translateX(20px) scale(1);opacity:0}
}

/* Claim spark burst FX */
.sparkWrap{position:relative;display:inline-block}
.spark{position:absolute;top:50%;left:50%;width:6px;height:6px;border-radius:50%;
  background:radial-gradient(circle,#fff6b0 0%,#ffd700 45%,rgba(255,215,0,0) 70%);
  box-shadow:0 0 12px rgba(255,215,0,.9);
  animation:sparkFly 1s ease-out forwards;
}
@keyframes sparkFly{
  0%{transform:translate(-50%,-50%) scale(1);opacity:1}
  100%{transform:translate(var(--tx),var(--ty)) scale(0.2);opacity:0}
}

/* Claimed mini label */
#claimedMsg{
  margin-top:6px;font-size:13px;color:#f6e27a;text-shadow:0 0 10px rgba(255,215,0,.55);
  opacity:0;transform:translateY(6px);transition:opacity .35s ease, transform .35s ease;
}

/* Footer */
footer{margin-top:18px;color:#888;font-size:14px}

/* Sound toggle */
#soundToggle{
  position:fixed;right:14px;bottom:14px;z-index:40;
  background:rgba(0,0,0,.6);border:1px solid #666;color:#ddd;font-size:12px;padding:8px 10px;border-radius:10px
}

/* Animations */
@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
@keyframes glow{from{box-shadow:0 0 10px rgba(255,215,0,.35)}to{box-shadow:0 0 25px rgba(255,215,0,.95)}}

/* Small helpers */
hr.sep{margin:14px 0;border:0;border-top:1px solid #2d2d2d}
</style>
</head>

<body>
<!-- ===================== HEADER ===================== -->
<header>
  <!-- ‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô: ‡∏õ‡∏∏‡πà‡∏°‡∏†‡∏≤‡∏©‡∏≤ -->
  <div class="leftBox">
    <button id="langToggle">EN</button>
  </div>

  <!-- ‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô: Connect + Refresh (‡πÄ‡∏•‡πá‡∏Å‡πÉ‡∏ï‡πâ Connect) -->
  <div class="rightBox">
    <button id="connectBtn">üîó Connect Wallet</button>
    <button id="refreshSmall">üîÑ Refresh</button>
  </div>
</header>

<!-- ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô -->
<div id="logo" aria-hidden="true"></div>

<!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏•‡∏∞‡∏≠‡∏≠‡∏á‡∏ó‡∏≠‡∏á -->
<div id="goldField" aria-hidden="true"></div>

<!-- ===================== MAIN ===================== -->
<h1 id="title">üåæ DNX FARM ULTRA++</h1>
<p id="subtitle" class="sub">‡∏£‡∏∞‡∏ö‡∏ö‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏à‡∏≤‡∏Å‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç Dynamix</p>

<div class="card">
  <!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ -->
  <div class="stats">
    <div class="stat"><div class="label" id="lblWallet">‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤</div><div id="waddr" class="value">‚Äî</div></div>
    <div class="stat"><div class="label" id="lblBal">‡∏¢‡∏≠‡∏î DNX ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div><div id="bal" class="value">‚Äî</div></div>
    <div class="stat"><div class="label" id="lblStake">Stake</div><div id="staked" class="value">‚Äî</div></div>
    <div class="stat"><div class="label" id="lblReward">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö</div><div id="pending" class="value">‚Äî</div><div id="pendingUSD">‚âà ‚Äî USD</div></div>
  </div>

  <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô -->
  <input id="amount" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô DNX" />

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å Deposit/Withdraw/Claim -->
  <div class="btns">
    <button id="deposit" class="action">üí∞ Deposit</button>
    <button id="withdraw" class="action">üíé Withdraw</button>
    <span class="sparkWrap">
      <button id="claim" class="action gold">üéÅ Claim</button>
      <div id="claimedMsg">‚úÖ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÅ‡∏•‡πâ‡∏ß!</div>
    </span>
  </div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏™‡∏£‡∏¥‡∏° ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏á‡πÉ‡∏ï‡πâ Claim -->
  <div class="stackedCol">
    <button id="buyBtn"  class="small">üõí BUY DNX</button>
    <button id="sellBtn" class="small">üí± SELL DNX</button>
  </div>

  <hr class="sep"/>

  <!-- Faucet ‡∏ü‡∏£‡∏µ (‡πÄ‡∏î‡∏¥‡∏°‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ) -->
  <button id="claimFree" class="small" style="background:linear-gradient(90deg,#00c6ff,#0072ff);color:#fff;">üéÅ Claim DNX ‡∏ü‡∏£‡∏µ</button>
  <div id="faucetInfo">‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‚Äî DNX ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏à‡∏Å</div>

  <footer>Powered by <b>DNX Finance</b> ¬© 2025</footer>
</div>

<!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á -->
<button id="soundToggle">üîä BGM</button>

<!-- ===================== SOUNDS ===================== -->
<!-- ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ -->
<audio id="sndClick" src="https://assets.mixkit.co/sfx/preview/mixkit-interface-click-1126.mp3" preload="auto"></audio>
<!-- ‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏Å‡∏£‡∏∞‡∏ó‡∏ö (Claim) -->
<audio id="sndCoin" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-complete-or-approved-mission-205.mp3" preload="auto"></audio>
<!-- ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≠‡∏á‡∏´‡∏°‡∏∏‡∏ô (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏´‡∏•‡∏±‡∏á Connect) -->
<audio id="sndBgm" src="https://cdn.pixabay.com/download/audio/2022/10/18/audio_2d3fe4d1d4.mp3?filename=soft-ambience-12475.mp3" preload="auto" loop></audio>

<!-- ===================== ETHERS ===================== -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<!-- ===================== SCRIPT ===================== -->
<script>
/* ---------- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏±‡∏ç‡∏ç‡∏≤ ---------- */
const TOKEN  = "0x7DB860CC9D7f64Ed1B39de6621ebc94440C8dc62";
const CHEF   = "0xEa13c02F1c69668c2C9f873Fe6fdf44FDD3B0C3C";
const FAUCET = "0x0000000000000000000000000000000000000000"; // üëà ‡πÉ‡∏™‡πà address Faucet ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì deploy

/* ---------- ABIs ---------- */
const ABIchef = [
  "function deposit(uint256) external",
  "function withdraw(uint256) external",
  "function pendingReward(address) view returns(uint256)",
  "function stakes(address) view returns(uint256 amount,uint256 rewardDebt)"
];
const ABItoken = [
  "function balanceOf(address) view returns(uint256)",
  "function decimals() view returns(uint8)",
  "function allowance(address,address) view returns(uint256)",
  "function approve(address,uint256) returns(bool)"
];
const ABIfaucet = [
  "function claim() external",
  "function claimed(address) view returns(bool)",
  "function dnxToken() view returns(address)",
  "function claimAmount() view returns(uint256)"
];

/* ---------- ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢ ---------- */
const $ = (id)=>document.getElementById(id);
const play = (el)=>{ try{ el.currentTime=0; el.play(); }catch(e){} };
function fmt(n,dec=18){ try{ return ethers.utils.formatUnits(n,dec); }catch{ return "0"; } }

/* ---------- State ---------- */
let provider, signer, user, token, chef, faucet, dec=18, priceUSD=0;
let bgmEnabled = true; // ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á

/* ---------- ‡∏†‡∏≤‡∏©‡∏≤ ---------- */
let lang = "TH";
const t = {
  TH:{toggle:"EN",connect:"üîó ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤",wallet:"‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤",total:"‡∏¢‡∏≠‡∏î DNX ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",stake:"‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Stake",reward:"‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö",
      placeholder:"‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô DNX",deposit:"üí∞ ‡∏ù‡∏≤‡∏Å (Deposit)",withdraw:"üíé ‡∏ñ‡∏≠‡∏ô (Withdraw)",claim:"üéÅ ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• (Claim)",
      buy:"üõí BUY DNX",sell:"üí± SELL DNX",refresh:"üîÑ Refresh",subtitle:"‡∏£‡∏∞‡∏ö‡∏ö‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏à‡∏≤‡∏Å‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç Dynamix",
      faucetBtn:"üéÅ Claim DNX ‡∏ü‡∏£‡∏µ",faucetLeft:(n,amt)=>`‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏à‡∏Å‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${n} ‡∏Ñ‡∏ô (${amt} DNX)`,claimed:"‚úÖ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÅ‡∏•‡πâ‡∏ß!"},
  EN:{toggle:"TH",connect:"üîó Connect Wallet",wallet:"Wallet",total:"Total DNX",stake:"Staked",reward:"Pending Reward",
      placeholder:"Enter DNX amount",deposit:"üí∞ Deposit",withdraw:"üíé Withdraw",claim:"üéÅ Claim",
      buy:"üõí BUY DNX",sell:"üí± SELL DNX",refresh:"üîÑ Refresh",subtitle:"Full farming system to earn Dynamix rewards",
      faucetBtn:"üéÅ Claim Free DNX",faucetLeft:(n,amt)=>`About ${n} users left (${amt} DNX)`,claimed:"‚úÖ Claimed!"}
};
function applyLang(){
  const L = t[lang];
  $("langToggle").textContent = L.toggle;
  $("connectBtn").textContent = L.connect;
  $("refreshSmall").textContent = L.refresh;
  $("lblWallet").textContent = L.wallet;
  $("lblBal").textContent = L.total;
  $("lblStake").textContent = L.stake;
  $("lblReward").textContent = L.reward;
  $("amount").placeholder = L.placeholder;
  $("deposit").textContent = L.deposit;
  $("withdraw").textContent = L.withdraw;
  $("claim").textContent = L.claim;
  $("buyBtn").textContent = L.buy;
  $("sellBtn").textContent = L.sell;
  $("subtitle").textContent = L.subtitle;
  $("claimFree").textContent = L.faucetBtn;
}
$("langToggle").addEventListener("click",()=>{
  lang = (lang==="TH") ? "EN" : "TH";
  applyLang();
  play($("sndClick"));
});
applyLang();

/* ---------- ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏•‡∏∞‡∏≠‡∏≠‡∏á‡∏ó‡∏≠‡∏á‡∏ä‡πâ‡∏≤‡πÜ ---------- */
(function makeParticles(){
  const field = $("goldField");
  const N = 40; // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏•‡∏∞‡∏≠‡∏≠‡∏á
  const vw = window.innerWidth, vh = window.innerHeight;
  for(let i=0;i<N;i++){
    const p=document.createElement("div");
    p.className="particle";
    const size = 4 + Math.random()*6;
    const left = Math.random()*vw;
    const delay = Math.random()*22;
    const duration = 18 + Math.random()*10;
    p.style.width = p.style.height = size+"px";
    p.style.left = left+"px";
    p.style.animationDuration = duration+"s";
    p.style.animationDelay = (-delay)+"s";
    field.appendChild(p);
  }
})();

/* ---------- Web3 ---------- */
async function connect(){
  play($("sndClick"));
  if(!window.ethereum){ alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á MetaMask ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô"); return; }
  provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts",[]);
  signer = provider.getSigner();
  user = await signer.getAddress();
  token = new ethers.Contract(TOKEN,ABItoken,signer);
  chef  = new ethers.Contract(CHEF ,ABIchef ,signer);
  faucet= new ethers.Contract(FAUCET,ABIfaucet,signer);
  try{ dec = await token.decimals(); }catch{ dec = 18; }
  $("waddr").textContent = user.slice(0,6)+"..."+user.slice(-4);

  // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏´‡∏•‡∏±‡∏á Connect ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
  if(bgmEnabled){
    const bgm = $("sndBgm"); bgm.volume = 0.25;
    play(bgm);
  }
  await refreshAll();
}

async function refreshAll(){
  if(!signer) return;
  try{
    const [bal, st, p] = await Promise.all([
      token.balanceOf(user),
      chef.stakes(user),
      chef.pendingReward(user)
    ]);
    $("bal").textContent = fmt(bal,dec);
    $("staked").textContent = fmt(st.amount,dec);
    $("pending").textContent = fmt(p,dec);
    await updateFaucetInfo();
  }catch(e){ console.error(e); }
}

async function ensureApprove(amount){
  const allow = await token.allowance(user,CHEF);
  if(allow.gte(amount)) return;
  const tx = await token.approve(CHEF, ethers.constants.MaxUint256);
  await tx.wait();
}

async function onDeposit(){
  play($("sndClick"));
  if(!signer) return alert("Connect wallet first");
  const v = $("amount").value.trim();
  if(!v) return alert(lang==="TH"?"‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô":"Enter an amount");
  try{
    const amt = ethers.utils.parseUnits(v,dec);
    await ensureApprove(amt);
    const tx = await chef.deposit(amt); await tx.wait();
    $("amount").value="";
    refreshAll();
  }catch(e){ console.error(e); }
}

async function onWithdraw(){
  play($("sndClick"));
  if(!signer) return alert("Connect wallet first");
  const v = $("amount").value.trim();
  if(!v) return alert(lang==="TH"?"‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô":"Enter an amount");
  try{
    const amt = ethers.utils.parseUnits(v,dec);
    const tx = await chef.withdraw(amt); await tx.wait();
    $("amount").value="";
    refreshAll();
  }catch(e){ console.error(e); }
}

/* ---------- ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå Claim: ‡∏™‡∏∞‡πÄ‡∏Å‡πá‡∏î‡∏ó‡∏≠‡∏á + ‡πÄ‡∏™‡∏µ‡∏¢‡∏á + ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ---------- */
function sparkBurst(btn){
  const wrap = btn.parentElement;
  const N = 26;
  for(let i=0;i<N;i++){
    const s = document.createElement("span");
    s.className = "spark";
    // ‡∏°‡∏∏‡∏°‡∏™‡∏∏‡πà‡∏°‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢ 360¬∞
    const angle = Math.random()*Math.PI*2;
    const dist = 70 + Math.random()*70;
    const tx = Math.cos(angle)*dist;
    const ty = Math.sin(angle)*dist;
    s.style.setProperty("--tx", (tx)+"px");
    s.style.setProperty("--ty", (ty)+"px");
    wrap.appendChild(s);
    setTimeout(()=>s.remove(), 1000);
  }
}

async function onClaim(){
  if(!signer) return alert("Connect wallet first");
  try{
    const tx = await chef.deposit(0); await tx.wait();
    // ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå + ‡πÄ‡∏™‡∏µ‡∏¢‡∏á
    sparkBurst($("claim"));
    const coin = $("sndCoin"); coin.volume = 0.8; play(coin);
    const msg = $("claimedMsg");
    msg.textContent = t[lang].claimed;
    msg.style.opacity = 1; msg.style.transform = "translateY(0)";
    setTimeout(()=>{ msg.style.opacity = 0; msg.style.transform = "translateY(6px)"; }, 2000);
    refreshAll();
  }catch(e){ console.error(e); }
}

/* ---------- Faucet ‡∏ü‡∏£‡∏µ ---------- */
async function onClaimFree(){
  play($("sndClick"));
  if(!signer) return alert("Connect wallet first");
  try{
    const contract = new ethers.Contract(FAUCET,["function claim() external","function claimed(address) view returns(bool)"],signer);
    const isClaimed = await contract.claimed(user);
    if(isClaimed) return alert(lang==="TH"?"‡∏Ñ‡∏∏‡∏ì‡∏£‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß":"Already claimed");
    const tx = await contract.claim(); await tx.wait();
    await updateFaucetInfo();
  }catch(e){ console.error(e); }
}

async function updateFaucetInfo(){
  try{
    const f = new ethers.Contract(FAUCET,ABIfaucet,provider);
    const tokenAddr = await f.dnxToken();
    const faucetToken = new ethers.Contract(tokenAddr,ABItoken,provider);
    const [bal, amt] = await Promise.all([faucetToken.balanceOf(FAUCET), f.claimAmount()]);
    const remain = amt.gt(0) ? bal.div(amt).toString() : "‚Äî";
    $("faucetInfo").textContent = t[lang].faucetLeft(remain, fmt(bal,dec));
  }catch(e){
    $("faucetInfo").textContent = "‚Äî";
  }
}

/* ---------- PancakeSwap BUY/SELL ---------- */
function onBuy(){ window.open("https://pancakeswap.finance/swap?outputCurrency="+TOKEN,"_blank"); }
function onSell(){ // input DNX, output BNB
  window.open("https://pancakeswap.finance/swap?inputCurrency="+TOKEN,"_blank");
}

/* ---------- ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á Toggle ---------- */
$("soundToggle").addEventListener("click",()=>{
  const bgm = $("sndBgm");
  if(bgm.paused){ bgmEnabled = true; play(bgm); $("soundToggle").textContent="üîä BGM"; }
  else{ bgm.pause(); bgmEnabled=false; $("soundToggle").textContent="üîá BGM"; }
});

/* ---------- Bind Events ---------- */
$("connectBtn").onclick = connect;
$("refreshSmall").onclick = ()=>{ play($("sndClick")); refreshAll(); };
$("deposit").onclick = onDeposit;
$("withdraw").onclick = onWithdraw;
$("claim").onclick = onClaim;
$("buyBtn").onclick = onBuy;
$("sellBtn").onclick = onSell;
$("claimFree").onclick = onClaimFree;

/* ---------- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ---------- */
document.addEventListener("DOMContentLoaded",()=>{
  // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°/‡∏†‡∏≤‡∏©‡∏≤
  applyLang();
});
</script>
</body>
</html>

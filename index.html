<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üåæ DNX FARM ULTRA++</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<style>
body {
  font-family: "Poppins", "Noto Sans Thai", sans-serif;
  background: radial-gradient(circle at top, #000 40%, #111 100%);
  color: #fff;
  text-align: center;
  overflow-x: hidden;
}
button { cursor: pointer; border: none; font-weight: bold; border-radius: 10px; }
.btn { background: linear-gradient(90deg,#00ffd5,#00c8a7); color:#000; padding:10px 18px; }
.gold { background: linear-gradient(90deg,#ffd700,#ff9d00); color:#000; padding:10px 18px; }
#logo { margin-top:30px; width:100px; height:100px; background:url('dnx_logo.png') center/cover no-repeat; border-radius:50%; animation:spin 10s linear infinite; margin:auto; }
@keyframes spin{to{transform:rotate(360deg)}}
.card { background:rgba(0,0,0,.7); border:2px solid #ffd700; border-radius:16px; padding:20px; width:min(95%,600px); margin:auto; margin-top:20px; box-shadow:0 0 20px rgba(255,215,0,.3); }
.stats { display:grid; grid-template-columns:repeat(2,1fr); gap:10px; }
.stat { border:1px solid #00ffd5; border-radius:10px; padding:10px; }
.stat .label{font-size:14px; opacity:.8}
.stat .value{font-weight:800; color:#ffd700;}
input{width:80%;padding:10px;margin:10px 0;border-radius:10px;border:1px solid #00ffd5;background:#000;color:#0ff;text-align:center}
</style>
</head>
<body>

<h1>üåæ DNX FARM ULTRA++</h1>
<div id="logo"></div>

<div class="card">
  <div class="stats">
    <div class="stat"><div class="label">‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤</div><div id="waddr" class="value">‚Äî</div></div>
    <div class="stat"><div class="label">‡∏¢‡∏≠‡∏î DNX ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div><div id="bal" class="value">‚Äî</div></div>
    <div class="stat"><div class="label">Stake</div><div id="staked" class="value">‚Äî</div></div>
    <div class="stat"><div class="label">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö</div><div id="pending" class="value">‚Äî</div></div>
  </div>

  <input id="amount" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô DNX" />
  <div>
    <button id="deposit" class="btn">üí∞ ‡∏ù‡∏≤‡∏Å (Deposit)</button>
    <button id="withdraw" class="btn">üíé ‡∏ñ‡∏≠‡∏ô (Withdraw)</button>
  </div>
  <div>
    <button id="claim" class="gold">üéÅ ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• (Claim)</button>
  </div>
  <p id="status"></p>
</div>

<script>
const TOKEN  = "0x7DB860CC9D7f64Ed1B39de6621ebc94440C8dc62";
const CHEF   = "0xEa13c02F1c69668c2C9f873Fe6fdf44FDD3B0C3C";

const ABItoken = [
  "function balanceOf(address) view returns(uint256)",
  "function decimals() view returns(uint8)",
  "function allowance(address,address) view returns(uint256)",
  "function approve(address,uint256) returns(bool)"
];

const ABIchef = [
  "function deposit(uint256 amount) external",
  "function withdraw(uint256 amount) external",
  "function pendingReward(address) view returns(uint256)",
  "function stakes(address) view returns(uint256 amount,uint256 rewardDebt)"
];

let provider, signer, user, token, chef, dec=18;

const $ = (id) => document.getElementById(id);
function fmt(bn,dec=18){ try{ return parseFloat(ethers.utils.formatUnits(bn,dec)).toFixed(2); }catch{return "0.00";}}

async function connect(){
  if(!window.ethereum) return alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á MetaMask ‡∏Å‡πà‡∏≠‡∏ô");
  provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = provider.getSigner();
  user = await signer.getAddress();
  token = new ethers.Contract(TOKEN, ABItoken, signer);
  chef = new ethers.Contract(CHEF, ABIchef, signer);
  dec = await token.decimals().catch(()=>18);
  $("waddr").textContent = user.slice(0,6)+"..."+user.slice(-4);
  refreshData();
}

async function refreshData(){
  if(!user) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡∏Å‡πà‡∏≠‡∏ô");
  const [bal, stakeInfo, pending] = await Promise.all([
    token.balanceOf(user),
    chef.stakes(user),
    chef.pendingReward(user)
  ]);
  $("bal").textContent = fmt(bal,dec);
  $("staked").textContent = fmt(stakeInfo.amount,dec);
  $("pending").textContent = fmt(pending,dec);
}

async function ensureApprove(amount){
  const allowance = await token.allowance(user, CHEF);
  if(allowance.gte(amount)) return;
  const tx = await token.approve(CHEF, ethers.constants.MaxUint256);
  await tx.wait();
}

async function deposit(){
  const v = $("amount").value.trim(); if(!v) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô");
  const amt = ethers.utils.parseUnits(v,dec);
  await ensureApprove(amt);
  const tx = await chef.deposit(amt); await tx.wait();
  $("status").textContent = "‚úÖ ‡∏ù‡∏≤‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
  refreshData();
}

async function withdraw(){
  const v = $("amount").value.trim(); if(!v) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô");
  const amt = ethers.utils.parseUnits(v,dec);
  const tx = await chef.withdraw(amt); await tx.wait();
  $("status").textContent = "‚úÖ ‡∏ñ‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
  refreshData();
}

async function claim(){
  const tx = await chef.deposit(0); await tx.wait();
  $("status").textContent = "üéÅ ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
  refreshData();
}

$("deposit").onclick = deposit;
$("withdraw").onclick = withdraw;
$("claim").onclick = claim;

connect();
</script>
</body>
</html>

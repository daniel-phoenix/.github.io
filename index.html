<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üåæ DNX STAKING ULTRA++</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.min.js"></script>
<style>
:root { --gold:#ffd700; --neon:#00ffd5; }
body {
  background: radial-gradient(circle at top,#000 40%,#111 100%);
  color:#fff; font-family:"Poppins","Noto Sans Thai",sans-serif;
  text-align:center; padding:30px;
}
button {
  background:var(--gold); color:#000; border:none; padding:10px 20px;
  margin:8px; border-radius:8px; font-weight:bold; cursor:pointer;
}
button:hover { background:var(--neon); }
input { padding:8px; width:180px; text-align:center; margin:6px; border-radius:6px; }
h1 { color:var(--gold); }
</style>
</head>
<body>
<h1>üåæ DNX STAKING ULTRA++</h1>
<p>Connect Wallet: <span id="waddr">‚ùå</span></p>
<p>Balance: <span id="bal">0</span> DNX</p>
<p>Staked: <span id="staked">0</span> DNX</p>
<p>Pending Reward: <span id="pending">0</span> DNX</p>

<input id="amount" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô DNX">
<br>
<button id="connectBtn">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤</button>
<button id="deposit">‡∏ù‡∏≤‡∏Å</button>
<button id="withdraw">‡∏ñ‡∏≠‡∏ô</button>
<button id="claim">‡πÄ‡∏Ñ‡∏•‡∏°‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</button>
<button id="buyDNX">‡∏ã‡∏∑‡πâ‡∏≠ DNX</button>

<script>
window.addEventListener("load", async () => {
  const TOKEN = "0x7DB860CC9D7f64Ed1B39de6621ebc94440C8dc62";
  const STAKING = "0x4CBc7013c8CF3347bba5775806C9Ec539Fe42E00";

  const ABItoken = [
    "function balanceOf(address) view returns(uint256)",
    "function decimals() view returns(uint8)",
    "function allowance(address,address) view returns(uint256)",
    "function approve(address,uint256) returns(bool)"
  ];
  const ABIstaking = [
    "function stake(uint256) external",
    "function unstake(uint256) external",
    "function pendingReward(address) view returns(uint256)",
    "function userInfo(address) view returns(uint256 amount,uint256 rewardDebt)"
  ];

  const $ = id => document.getElementById(id);
  const fmt = (bn, dec=18)=>parseFloat(ethers.utils.formatUnits(bn, dec)).toFixed(4);
  let provider, signer, user, token, staking, dec=18;

  async function connect(){
    if(!window.ethereum) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î MetaMask");
    const acc = await ethereum.request({ method:"eth_requestAccounts" });
    user = acc[0];
    provider = new ethers.providers.Web3Provider(window.ethereum);
    signer = provider.getSigner();
    token = new ethers.Contract(TOKEN, ABItoken, signer);
    staking = new ethers.Contract(STAKING, ABIstaking, signer);
    dec = await token.decimals();
    $("waddr").textContent = user.slice(0,6)+"..."+user.slice(-4);
    refresh();
  }
  $("connectBtn").onclick = connect;

  async function refresh(){
    if(!user) return;
    const [bal, info, reward] = await Promise.all([
      token.balanceOf(user),
      staking.userInfo(user),
      staking.pendingReward(user)
    ]);
    $("bal").textContent = fmt(bal, dec);
    $("staked").textContent = fmt(info.amount, dec);
    $("pending").textContent = fmt(reward, dec);
  }

  $("deposit").onclick = async ()=>{
    const amt = ethers.utils.parseUnits($("amount").value, dec);
    const tx = await staking.stake(amt); await tx.wait(); refresh();
  };
  $("withdraw").onclick = async ()=>{
    const amt = ethers.utils.parseUnits($("amount").value, dec);
    const tx = await staking.unstake(amt); await tx.wait(); refresh();
  };
  $("claim").onclick = async ()=>{
    const tx = await staking.stake(0); await tx.wait(); refresh();
  };
  $("buyDNX").onclick = ()=>window.open(`https://pancakeswap.finance/swap?outputCurrency=${TOKEN}`);
});
</script>
</body>
</html>

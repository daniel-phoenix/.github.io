<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üåæ DNX FARM ULTRA++ PRO</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.11.1/dist/ethers.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
:root{--gold:#ffd700;--neon:#00ffd5}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow-x:hidden;}
body{
  background: radial-gradient(circle at center, #000 40%, #111 100%);
  color:#fff;font-family:"Poppins",sans-serif;text-align:center;
  display:flex;flex-direction:column;align-items:center;
  justify-content:flex-start;min-height:100vh;overflow:hidden;
}
header{
  width:100%;background:linear-gradient(90deg,#111,#222,#111);
  border-bottom:2px solid var(--gold);padding:10px 0;position:fixed;top:0;left:0;z-index:10;
  box-shadow:0 0 20px rgba(255,215,0,.4);
  display:flex;justify-content:space-between;align-items:center;
  padding:10px 20px;
}
#connectBtn{
  background:linear-gradient(90deg,#ffd700,#ff9d00);border:none;
  color:#000;font-weight:bold;padding:10px 25px;border-radius:20px;
  cursor:pointer;animation:glow 2s infinite alternate;
}
@keyframes glow{
  from{box-shadow:0 0 10px rgba(255,215,0,.4);}
  to{box-shadow:0 0 25px rgba(255,215,0,1);}
}
#langToggle{
  background:rgba(0,0,0,.6);border:1px solid var(--gold);
  color:var(--gold);font-weight:bold;padding:8px 15px;
  border-radius:12px;cursor:pointer;
}
#logo{
  position:fixed;top:70px;left:25px;width:90px;height:90px;
  border-radius:50%;
  background:url('dnx_logo.png') center/cover no-repeat;
  box-shadow:0 0 20px rgba(255,215,0,0.7),inset 0 0 25px rgba(255,215,0,0.6);
  animation:spin 12s linear infinite;
  z-index:10;
}
@keyframes spin{from{transform:rotate(0);}to{transform:rotate(360deg);}}
h1{margin-top:160px;color:var(--gold);font-size:2em;text-shadow:0 0 30px rgba(255,215,0,.7);}
p{opacity:.9;margin:10px 0 25px;}
.card{
  background:rgba(0,0,0,.7);border:2px solid var(--gold);border-radius:16px;
  box-shadow:0 0 30px rgba(255,215,0,.3);padding:25px;
  width:min(95%,650px);z-index:2;
}
.stats{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:10px;}
.stat{background:rgba(255,255,255,.05);border:1px solid var(--neon);border-radius:10px;padding:10px;}
.stat .label{font-size:14px;opacity:.8}.stat .value{font-weight:bold;color:var(--gold);}
#pendingUSD{font-size:13px;color:#aaa;margin-top:2px;}
input{
  width:80%;padding:10px;margin:10px 0;border-radius:10px;
  border:1px solid var(--neon);background:#000;color:var(--neon);text-align:center;
}
button{
  border:none;border-radius:10px;padding:10px 18px;margin:5px;
  font-weight:bold;cursor:pointer;
}
.btn{background:linear-gradient(90deg,#00ffd5,#00c8a7);color:#000;}
.gold{background:linear-gradient(90deg,#ffd700,#ff9d00);color:#000;}
button:hover{transform:scale(1.05);}
footer{margin-top:20px;color:#888;font-size:14px;}
.glowValue{animation:glowReward 1.5s ease;}
@keyframes glowReward{0%{text-shadow:0 0 10px var(--gold);}100%{text-shadow:none;}}
canvas{margin-top:25px;width:100%!important;height:280px!important;}
</style>
</head>
<body>
<header>
  <button id="connectBtn">üîó Connect Wallet</button>
  <button id="langToggle">EN</button>
</header>

<div id="logo"></div>

<h1 id="title">üåæ DNX FARM ULTRA++ PRO</h1>
<p id="subtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏£‡∏≤‡∏ü‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</p>

<div class="card">
  <div class="stats">
    <div class="stat"><div class="label" id="walletLabel">‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤</div><div id="waddr" class="value">‚Äî</div></div>
    <div class="stat"><div class="label" id="balLabel">‡∏¢‡∏≠‡∏î DNX ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div><div id="bal" class="value">‚Äî</div></div>
    <div class="stat"><div class="label" id="stakeLabel">Stake</div><div id="staked" class="value">‚Äî</div></div>
    <div class="stat">
      <div class="label" id="pendLabel">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö</div>
      <div id="pending" class="value">‚Äî</div>
      <div id="pendingUSD">‚âà ‚Äî USD</div>
    </div>
  </div>

  <input id="amount" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô DNX" />
  <div>
    <button id="deposit" class="btn">üí∞ Deposit</button>
    <button id="withdraw" class="btn">üíé Withdraw</button>
    <button id="claim" class="btn gold">üéÅ Claim</button>
    <button id="refresh" class="btn">üîÑ Refresh</button>
  </div>

  <!-- üî• ‡∏Å‡∏£‡∏≤‡∏ü‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• -->
  <canvas id="rewardChart"></canvas>

  <footer>Powered by <b>DNX Finance</b> ¬© 2025</footer>
</div>

<audio id="clickSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_f8bcb2fca4.mp3?filename=click-124467.mp3" preload="auto"></audio>
<audio id="rewardSound" src="https://cdn.pixabay.com/download/audio/2022/03/23/audio_8a75c7c03b.mp3?filename=coin-bell-glow-115372.mp3" preload="auto"></audio>
<audio id="connectSound" src="https://cdn.pixabay.com/download/audio/2023/05/18/audio_588b05f527.mp3?filename=success-158050.mp3" preload="auto"></audio>

<script>
const CHEF='0xEa13c02F1c69668c2C9f873Fe6fdf44FDD3B0C3C';
const TOKEN='0x7DB860CC9D7f64Ed1B39de6621ebc94440C8dc62';
const ABIchef=[
  "function deposit(uint256) external",
  "function withdraw(uint256) external",
  "function pendingReward(address) view returns(uint256)",
  "function userInfo(address) view returns(uint256 amount,uint256 rewardDebt)"
];
const ABItoken=[
  "function balanceOf(address) view returns(uint256)",
  "function decimals() view returns(uint8)",
  "function allowance(address,address) view returns(uint256)",
  "function approve(address,uint256) returns(bool)"
];

let provider,signer,chef,token,user,dec=18,priceDNX=0,lastReward=0;
const $=id=>document.getElementById(id);
const playSound=(id)=>{const s=$(id);s.currentTime=0;s.play();}

// üîπ ‡∏Å‡∏£‡∏≤‡∏ü‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
const ctx=document.getElementById("rewardChart");
const chartData={labels:[],datasets:[{label:"DNX Reward",data:[],borderColor:"#ffd700",borderWidth:2,fill:false,tension:0.3}]};
const rewardChart=new Chart(ctx,{type:"line",data:chartData,options:{
  scales:{x:{ticks:{color:"#aaa"}},y:{ticks:{color:"#aaa"}}},
  plugins:{legend:{labels:{color:"#ffd700"}}}
}});

// ‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MetaMask
async function connect(){
  playSound("clickSound");
  if(!window.ethereum)return alert(msg('needMM'));
  provider=new ethers.BrowserProvider(window.ethereum);
  await provider.send("eth_requestAccounts",[]);
  signer=await provider.getSigner();
  user=await signer.getAddress();
  chef=new ethers.Contract(CHEF,ABIchef,signer);
  token=new ethers.Contract(TOKEN,ABItoken,signer);
  dec=await token.decimals();
  $("waddr").textContent=user.slice(0,6)+"..."+user.slice(-4);
  playSound("connectSound");
  refreshAll(); startAutoUpdate(); fetchDNXPrice();
}

// ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤ DNX
async function fetchDNXPrice(){
  try{
    const res=await fetch("https://api.coingecko.com/api/v3/simple/price?ids=binancecoin&vs_currencies=usd");
    const data=await res.json();
    priceDNX = data.binancecoin.usd * 0.00005; 
  }catch(e){console.warn("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤ DNX ‡πÑ‡∏î‡πâ");}
}

// ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
async function refreshAll(){
  if(!signer)return;
  const [bal,info,pending]=await Promise.all([
    token.balanceOf(user),chef.userInfo(user),chef.pendingReward(user)
  ]);
  $("bal").textContent=(Number(ethers.formatUnits(bal,dec))).toFixed(2);
  $("staked").textContent=(Number(ethers.formatUnits(info.amount,dec))).toFixed(2);
  updatePending(Number(ethers.formatUnits(pending,dec)));
}

// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• + ‡∏Å‡∏£‡∏≤‡∏ü
function updatePending(newVal){
  if(newVal!==lastReward){
    $("pending").textContent=newVal.toFixed(4);
    const usd=(newVal*priceDNX).toFixed(2);
    $("pendingUSD").textContent=`‚âà ${usd} USD`;
    $("pending").classList.add("glowValue");
    setTimeout(()=>$("pending").classList.remove("glowValue"),1000);
    const time=new Date().toLocaleTimeString();
    chartData.labels.push(time);
    chartData.datasets[0].data.push(newVal);
    if(chartData.labels.length>10){chartData.labels.shift();chartData.datasets[0].data.shift();}
    rewardChart.update();
    lastReward=newVal;
  }
}

// ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
function startAutoUpdate(){
  setInterval(async()=>{
    if(signer){
      const pending=await chef.pendingReward(user);
      updatePending(Number(ethers.formatUnits(pending,dec)));
    }
  },10000);
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ù‡∏≤‡∏Å ‡∏ñ‡∏≠‡∏ô ‡πÄ‡∏Ñ‡∏•‡∏°
async function act(fn){
  playSound("clickSound");
  try{
    const val=$("amount").value.trim();if(!val)return;
    const amt=ethers.parseUnits(val,dec);
    if(fn==="deposit"){
      const allow=await token.allowance(user,CHEF);
      if(allow<amt){const txa=await token.approve(CHEF,amt);await txa.wait();}
    }
    const tx=await chef[fn](amt);await tx.wait();refreshAll();
  }catch(e){alert("‚ùå "+e.message);}
}
async function claim(){
  playSound("rewardSound");
  try{
    const tx=await chef.deposit(0);await tx.wait();refreshAll();
  }catch(e){alert("‚ùå "+e.message);}
}

// ‡∏õ‡∏∏‡πà‡∏°
$("connectBtn").onclick=connect;
$("deposit").onclick=()=>act("deposit");
$("withdraw").onclick=()=>act("withdraw");
$("claim").onclick=claim;
$("refresh").onclick=()=>refreshAll();

// ‡∏†‡∏≤‡∏©‡∏≤
let lang="th";
const text={
  th:{title:"üåæ DNX FARM ULTRA++ PRO",subtitle:"‡∏£‡∏∞‡∏ö‡∏ö‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏£‡∏≤‡∏ü‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå",walletLabel:"‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤",balLabel:"‡∏¢‡∏≠‡∏î DNX ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",stakeLabel:"‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á Stake",pendLabel:"‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Ñ‡πâ‡∏≤‡∏á‡∏£‡∏±‡∏ö",needMM:"‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á MetaMask ‡∏Å‡πà‡∏≠‡∏ô !"},
  en:{title:"üåæ DNX FARM ULTRA++ PRO",subtitle:"Full-featured farming system with live reward chart",walletLabel:"Wallet",balLabel:"DNX Balance",stakeLabel:"Staked",pendLabel:"Pending Reward",needMM:"‚ö†Ô∏è Please install MetaMask first!"}
};
function msg(k){return text[lang][k]||k;}
$("langToggle").onclick=()=>{
  lang=lang==="th"?"en":"th";
  $("langToggle").textContent=lang==="th"?"EN":"TH";
  $("title").textContent=text[lang].title;
  $("subtitle").textContent=text[lang].subtitle;
  $("walletLabel").textContent=text[lang].walletLabel;
  $("balLabel").textContent=text[lang].balLabel;
  $("stakeLabel").textContent=text[lang].stakeLabel;
  $("pendLabel").textContent=text[lang].pendLabel;
};
</script>
</body>
</html>

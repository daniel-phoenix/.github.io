<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üåæ DNX FARM ULTRA++</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<style>
:root {
  --gold:#ffd700;
  --neon:#00ffd5;
}
body {
  background:#000;
  color:#fff;
  font-family:"Poppins","Noto Sans Thai",sans-serif;
  text-align:center;
  margin:0;
  padding:0;
}
header {
  background:linear-gradient(90deg,#111,#222,#111);
  padding:10px;
  border-bottom:2px solid var(--gold);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
button {
  border:none;
  padding:10px 18px;
  margin:5px;
  border-radius:8px;
  font-weight:700;
  cursor:pointer;
  color:#000;
  background:var(--gold);
  transition:all 0.2s;
}
button:hover {transform:scale(1.05);}
.box {
  display:inline-block;
  background:#111;
  border:1px solid var(--neon);
  border-radius:10px;
  padding:10px 15px;
  margin:5px;
  width:130px;
}
input {
  border-radius:5px;
  border:1px solid var(--gold);
  padding:8px;
  width:60%;
  text-align:center;
  margin:10px auto;
  display:block;
}
footer {
  margin-top:30px;
  color:#888;
}
</style>
</head>
<body>

<header>
  <div>üåæ DNX FARM ULTRA++</div>
  <button id="connectBtn">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤</button>
</header>

<h3 style="color:var(--gold);margin-top:30px;">Dashboard</h3>

<div>
  <div class="box">Wallet<br><span id="wallet">-</span></div>
  <div class="box">Total DNX<br><span id="totalDNX">-</span></div>
  <div class="box">Your Stake<br><span id="yourStake">-</span></div>
  <div class="box">Pending Reward<br><span id="pendingReward">-</span></div>
</div>

<input type="number" id="amount" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô DNX">

<div>
  <button id="depositBtn">üí∞ ‡∏ù‡∏≤‡∏Å (Deposit)</button>
  <button id="withdrawBtn">üíé ‡∏ñ‡∏≠‡∏ô (Withdraw)</button>
  <button id="claimBtn">üéÅ ‡πÄ‡∏Ñ‡∏•‡∏°‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• (Claim)</button>
</div>

<footer>
  Powered by <span style="color:var(--gold)">DNX Finance ¬© 2025</span>
</footer>

<script>
const TOKEN = "0x7DB860CC9D7f64Ed1B39de6621ebc94440C8dc62";     // DNXToken
const STAKING = "0x32A2828c6A5F095d4e8F0687Cdcc39294923e7d5";  // DNXStakingMC
const TREASURY = "0xc7f1d5260C0e97E90EFbc9C989DF5193cfb3bE54";  // DNXTreasury ‡πÉ‡∏´‡∏°‡πà ‚úÖ

// ==== Minimal ABI ====
const tokenABI = [
  "function approve(address spender,uint256 amount) external returns (bool)",
  "function balanceOf(address account) external view returns (uint256)",
  "function decimals() external view returns (uint8)"
];
const stakingABI = [
  "function deposit(uint256 amount) external",
  "function withdraw(uint256 amount) external",
  "function claim() external",
  "function getStake(address user) external view returns (uint256)",
  "function pendingReward(address user) external view returns (uint256)"
];

let provider, signer, token, staking, userAddr;

async function connectWallet(){
  if(window.ethereum){
    provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    signer = provider.getSigner();
    userAddr = await signer.getAddress();
    document.getElementById("wallet").innerText = userAddr.slice(0,6)+"..."+userAddr.slice(-4);
    token = new ethers.Contract(TOKEN, tokenABI, signer);
    staking = new ethers.Contract(STAKING, stakingABI, signer);
    updateInfo();
  } else {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á MetaMask ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
  }
}

async function updateInfo(){
  try {
    const [balance, staked, pending] = await Promise.all([
      token.balanceOf(userAddr),
      staking.getStake(userAddr),
      staking.pendingReward(userAddr)
    ]);
    const decimals = await token.decimals();
    const div = ethers.BigNumber.from(10).pow(decimals);
    document.getElementById("totalDNX").innerText = (balance/div).toFixed(2);
    document.getElementById("yourStake").innerText = (staked/div).toFixed(2);
    document.getElementById("pendingReward").innerText = (pending/div).toFixed(2);
  } catch(e){
    console.log("Update error:",e);
  }
}

async function deposit(){
  const amount = document.getElementById("amount").value;
  if(!amount) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô DNX");
  const decimals = await token.decimals();
  const value = ethers.utils.parseUnits(amount, decimals);
  await token.approve(STAKING, value);
  const tx = await staking.deposit(value);
  await tx.wait();
  alert("‡∏ù‡∏≤‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ");
  updateInfo();
}

async function withdraw(){
  const amount = document.getElementById("amount").value;
  if(!amount) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô DNX");
  const decimals = await token.decimals();
  const value = ethers.utils.parseUnits(amount, decimals);
  const tx = await staking.withdraw(value);
  await tx.wait();
  alert("‡∏ñ‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ");
  updateInfo();
}

async function claim(){
  const tx = await staking.claim();
  await tx.wait();
  alert("‡πÄ‡∏Ñ‡∏•‡∏°‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à üéâ");
  updateInfo();
}

document.getElementById("connectBtn").onclick = connectWallet;
document.getElementById("depositBtn").onclick = deposit;
document.getElementById("withdrawBtn").onclick = withdraw;
document.getElementById("claimBtn").onclick = claim;
</script>

</body>
</html>
